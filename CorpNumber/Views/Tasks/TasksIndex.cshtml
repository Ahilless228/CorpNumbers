@model IEnumerable<CorpNumber.Models.TaskItem>

@{
    var incompleteTasks = Model.Where(t => t.Complete != true).OrderBy(t => t.TaskDate).ToList();
    var completeTasks = Model.Where(t => t.Complete == true).OrderBy(t => t.TaskDate).ToList();
    var allTasks = incompleteTasks.Concat(completeTasks).ToList();
    var incompleteCount = incompleteTasks.Count;
}

<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold">Задачи/Напоминания</h4>
        <img src="~/images/altynken-logo.jpg" style="height: 35px;" />
    </div>

    <!-- Buttons -->
    <div class="mb-3 d-flex gap-2 flex-wrap">
        <button class="btn btn-primary" id="btnAddTask">Добавить задачу</button>
        <button class="btn btn-warning" id="btnEditTask">Изменить задачу</button>
        <button class="btn btn-danger" id="btnDeleteTask">Удалить задачу</button>
        <button class="btn btn-success" id="btnToggleComplete">Выполнено/Не выполнено</button>
    </div>

    <!-- Table -->
    <div id="taskTableContainer">
        @await Html.PartialAsync("_TasksTablePartial", Model)
    </div>


    <!-- Summary -->
    <div class="mt-3">
        <strong>Количество невыполненных задач:</strong> @incompleteCount
    </div>
</div>

<!-- Modal for Add/Edit Task -->
<div class="modal fade" id="taskModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between">
                <h5 class="modal-title" id="taskModalTitle">Новая задача/напоминание</h5>
                <img src="~/images/altynken-logo.jpg" style="height: 30px;" />
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="CodeTask" name="CodeTask" />
                    <div class="mb-3">
                        <label class="form-label">Дата создания</label>
                        <input type="date" class="form-control" id="CreateDate" name="CreateDate" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Дата выполнения</label>
                        <input type="date" class="form-control" id="TaskDate" name="TaskDate" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Текст задачи</label>
                        <textarea class="form-control" id="TaskText" name="TaskText" rows="3" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" id="saveTaskBtn">Сохранить</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/TasksScript.js"></script>
}
